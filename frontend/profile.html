<!-- profile.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profile — SereneWrite</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="navbar">
    <div class="nav-container">

      <a href="index.html" class="nav-logo">✨ SereneWrite</a>

      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#about">About Us</a>
        <a href="profile.html" id="navProfile" class="hidden">Profile</a>
        <a href="edit-post.html" id="navNewPost" class="hidden">New Post</a>
        <a href="login.html" id="navAuth">Login</a>
        <button id="logoutBtn" class="nav-btn hidden">Logout</button>
      </nav>

    </div>
  </header>

  <main class="container">
    <section id="profileCard" class="card profile-card"></section>

    <section>
      <h3>Your Posts</h3>
      <div id="myPosts" class="grid"></div>
    </section>
  </main>

  <script src="script.js"></script>
  <script>
    (async function () {
      initNav();

      const token = localStorage.getItem('token');
      if (!token) { location.href = 'login.html'; return; }

      try {
        const user = await apiFetch('/api/user/me', 'GET');
        renderProfile(user);
        const posts = await apiFetch(`/api/post/user/${user._id}`, 'GET');
        renderPostsList(posts, document.getElementById('myPosts'), true);
      } catch (err) {
        console.error(err);
        // Redirect to login if unauthorized, otherwise show message
        if (err.message && /unauthori|401/i.test(err.message)) {
          location.href = 'login.html';
        } else {
          const area = document.getElementById('profileCard');
          if (area) area.innerHTML = '<p>Failed to load profile.</p>';
        }
      }
    })();
  </script>
</body>
</html>
